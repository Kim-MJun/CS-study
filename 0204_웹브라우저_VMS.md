# 웹브라우저 VMS

### 1. 서버 -> 웹을 위한 비디오 스트리밍 프로토콜

**1-1. `WebRTC`: 실시간 비디오 스트리밍에 가장 적합한 프로토콜. 지연 시간이 매우 짧고 P2P연결 지원**

```
## 장점
- 가장 낮은 지연시간 (100ms) 이하 가능
- P2P연결로 서버 부하 감소
- 양방향 실시간 통신 가능

## 단점
- 구현이 복잡함
- 많은 동시 연결시 클라이언트 리소스 부담
- *STUN/TURN* 서버 필요
  - WebRTC에서 P2P 연결을 도와주는 서버
  - STUN(Session Traversal Utilities for NAT), TURN(Traversal Using Relays around NAT)
```

**1-2. `HLS (HTTP Live Streaming)` : 대역폭 적응형 스트리밍이 가능하며, 브라우저 호환성이 좋음**

```
## 장점
- 안정적인 스트리밍
- 대역폭 적응형
- 브라우저 호환성 좋음

## 단점
- 높은 지연시간으로 실시간성 떨어짐 (보통 10~30초)
- 양방향 통신 불가
```

**1-3. `WHEP/WHIP(WebRTC-HTTP Egress/Ingress Protocol)` : 복잡한 WebRTC의 과정을 HTTP 프로토콜을 이용해 간단히 만든 것.**

```
## 장점
- WebRTC의 낮은 지연시간 특성은 유지
- 구현이 WebRTC에 비해 더 간단함
- HTTP를 사용해 방화벽 문제가 적음

## 단점
- 비교적 새로운 기술이라 지원하는 생태계가 넓지는 않음
- P2P가 아니라서 서버를 반드시 거쳐야 함
- 서버 비용이 더 발생할 수 있음

정리하면, 기존 WebRTC의 복잡한 설정 없이 실시간 영상 스트리밍이 가능한 새로운 방식.
하지만, 아직 발전중인 기술이라 프로젝트의 상황과 요구사항을 고려해서 선택하는 것이 중요.
```

---

### 2. VMS 전체적인 흐름

```
IP 카메라 <-> RTSP <-> 미디어 서버 <-> WebRTC <-> 웹 브라우저
```

##### 1. CCTV -> RTSP

- CCTV 카메라가 RTSP 프로토콜로 영상 스트림을 전송

##### 2. RTSP -> ffmpeg -> WebRTC

- ffmpeg이 RTSP 스트림을 받아 WebRTC에 적합한 포맷으로 변환
- 해당 과정에서 코덱 변환, 해상도 저장, 프레임레이트 최적화 등이 가능

##### 3. 서버 -> WebRTC -> 클라이언트

- 변환된 스트림을 WebRTC를 통해 클라이언트로 전송
- WebRTC의 P2P 특성으로 낮은 지연시간 유지 가능

##### 4. 클라이언트 브라우저

- WebRTC를 통해 받은 스트림을 웹 페이지에 표시

```
해당 방식의 장점으로는
- 낮은 지연시간 (실시간성에서 가장 중요)
- 실시간 양방향 통신 가능
- 브라우저 호환성 좋음
- 네트워크 상태에 따른 적응형 스트리밍
```

---

전체적으로 정리하자면,

- CCTV 기반 VMS 시스템은 실시간성이 가장 중요하므로 `WebRTC`, `WHEP/WHIP` 를 주력으로 사용하되, 프로젝트의 상황과 요구사항을 고려해서 선택해야 됨
- 전체 시스템 프로세스를 간략히 나타내면 아래와 같다
  - `CCTV -> RTSP -> ffmpeg -> WebRTC -> 클라이언트`
